import json
import winreg
import os

abs_path = os.path.dirname(os.path.realpath(__file__))

def scan_regs():
    reg_json = open(abs_path + "\\reg.json", "r")
    reg_load = json.load(reg_json)

    for _, v in reg_load.items():
        root_key = v["rootkey"]
        reg_key = v["regkey"]
        path = v["path"]
        full_path = v["fullpath"]

        setting = ""

        if root_key == "HKLM":
            setting = winreg.HKEY_LOCAL_MACHINE
        elif root_key == "HKCU":
            setting = winreg.HKEY_CURRENT_USER

        try:
            winreg_key = winreg.OpenKeyEx(setting, path)
            winreg.QueryValueEx(winreg_key, reg_key)
            print(f"[Infected] {reg_key} |", full_path)
            winreg.CloseKey(winreg_key)
        except:
            pass


def scan_files():
    file_json = open(abs_path + "\\file.json", "r")
    file_load = json.load(file_json)

    for k, v in file_load.items():
        file_path = v["path"]

        if os.path.exists(file_path):
            print(f"[Infected] {k} |", file_path)


def main():
    scan_regs()
    scan_files()
    print("Completed")


if __name__ == "__main__":
    main()
